# AWS Monitoring, Notification and Autoscaling#

AWS is equipped with a package of monitoring and notification services. In order to monitor our AWS resources and notify PIA in case of alarms triggered, we use **AWS CloudWatch** Service and **AWS Simple Notification Service.**

### AWS CloudWatch ###

Amazon CloudWatch is a monitoring service for AWS cloud
resources and the applications you run on AWS. We can use Amazon CloudWatch
to collect and track metrics, collect and monitor log files, set alarms, and
automatically react to changes in your AWS resources. Amazon CloudWatch can
monitor AWS resources such as Amazon EC2 instances, Amazon DynamoDB tables,
and Amazon RDS DB instances, as well as custom metrics generated by your
applications and services, and any log files your applications generate. You
can use Amazon CloudWatch to gain system-wide visibility into resource
utilization, application performance, and operational health. You can use
these insights to react and keep your application running smoothly. 

### Amazon Simple Notification Service (SNS) ###

Amazon Simple Notification Service (Amazon SNS) is a fast, flexible, fully managed push notification service that lets us send individual messages or to fan-out messages to large numbers of recipients. Amazon SNS makes it simple and cost effective to send push notifications to mobile device users, email recipients or even send messages to other distributed services. 

# SNS Setup #

### Create a Topic ###

A topic is a communication channel to send messages and subscribe to notifications. It provides an access point for publishers and subscribers to communicate with each other.

1. In the Amazon SNS console, click Create topic. The Create topic dialog box appears.
2. In the Topic name box, type a topic name.
3. Click Create topic. The new topic appears in the Topics page.
4. Select the new topic and then click the topic ARN.
5. Copy the topic ARN for the next task.

### Subscribe to a Topic ###

To receive messages published to a topic, you have to subscribe an endpoint to that topic. An endpoint is a mobile app, web server, email address, or an Amazon SQS queue that can receive notification messages from Amazon SNS. Once you subscribe an endpoint to a topic and the subscription is confirmed, the endpoint will receive all messages published to that topic.

1. Open the Amazon SNS console at https://console.aws.amazon.com/sns/.
2. Click Create subscription. The Create Subscription dialog box appears.
3. In the Topic ARN field, paste the topic ARN you created in the previous task, for example: arn:aws:sns:us-west-2:111122223333:MyTopic.
4. In the Protocol drop-down box, select Email.
5. In the Endpoint box, type an email address you can use to receive the notification.
   ** Important **
   Entourage Users: Entourage strips out the confirmation URL. Type an email address you can access in a different email application.
6. Click Create subscription.
7. Go to your email application and open the message from AWS Notifications, and then click the link to confirm your subscription. Your web browser displays a confirmation response from Amazon SNS.

### Publish to a Topic ###
Publishers send messages to topics. Once a new message is published, Amazon SNS attempts to deliver that message to every endpoint that is subscribed to the topic. In this section you publish a message to the email address you defined in the previous step.

1. Open the Amazon SNS console at https://console.aws.amazon.com/sns/. In the left navigation pane, click Topics and then select the topic you want to publish to.
2. Click the Publish to topic button. The Publish a Message page appears.
3. In the Subject box, type a subject line for your message.
4. In the Message box, type a brief message.
5. Click Publish Message. A confirmation dialog box appears. 

You can now use your email application to open the message from AWS Notifications and read the message.

# CloudWatch Alarms

We can create a CloudWatch alarm that sends an Amazon Simple Notification Service(SNS) message when the alarm changes state. An alarm watches a single metric over a time period we specify, and performs one or more actions based on the value of the metric relative to a given threshold over a number of time periods. The action is a notification sent to an Amazon Simple Notification Service topic or Auto Scaling policy. Alarms invoke actions for sustained state changes only. CloudWatch alarms will not invoke actions simply because they are in a particular state, the state must have changed and been maintained for a specified number of periods.

After an alarm invokes an action due to a change in state, its subsequent behavior depends on the type of action that we have associated with the alarm. For Auto Scaling policy notifications, the alarm continues to invoke the action for every period that the alarm remains in the new state. For Amazon Simple Notification Service notifications, no additional actions are invoked.

An alarm has three possible states:

* OK — The metric is within the defined threshold
* ALARM — The metric is outside of the defined threshold
* INSUFFICIENT_DATA — The alarm has just started, the metric is not available, or not enough data is available for the metric to determine the alarm state

We can set the alarm threshold and evaluation period so that the alarm invokes its action if the metric data is breaching for a period of evaluation period. Illustrated as the figure below. This alarm is set with 3 as threshold and 3 as evaluation period.

![alarm_graph.png](https://bitbucket.org/repo/dBgzdj/images/1020165946-alarm_graph.png)

** Note **

*Some AWS resources do not send metric data to CloudWatch under certain conditions. For example, Amazon EBS may not send metric data for an available volume that is not attached to an Amazon EC2 instance, because there is no metric activity to be monitored for that volume. If you have an alarm set for such a metric, you may notice its state change to Insufficient Data. This may simply be an indication that your resource is inactive, and may not necessarily mean that there is a problem.*

## Step 1 - Set Up Amazon Simple Notification Service

Amazon CloudWatch uses Amazon Simple Notification Service (Amazon SNS) to send email. This section shows you how to create and subscribe to an Amazon Simple Notification Service topic. When you create a CloudWatch alarm, you can add this Amazon SNS topic to send an email notification when the alarm changes state.

We create your CloudWatch alarm with the AWS Management Console so we can create an Amazon Simple Notification Service topic in the Configure Actions step in the Create Alarm Wizard.

## Step 2 - Create or Edit an Alarm ##
We can create or edit an alarm from the Alarms list in the Amazon CloudWatch console. 

1. Open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.
2. If necessary, change the region. From the navigation bar, select the region that meets your needs. For more information, see Regions and Endpoints in the Amazon Web Services General Reference.
3. In the navigation pane, click Alarms.
4. Click Create Alarm, and then in the CloudWatch Metrics by Category pane, select a metric category, for example, EC2 Metrics.
5. Select a metric, (for example, CPUUtilization), and then click Next.
6. Under Alarm Threshold, complete the fields, and then under Actions, select the type of action you want the alarm to perform when the alarm is triggered. You can choose specific metrics to trigger the alarm and specify thresholds for those metrics. You can then set your alarm to change state when a metric exceeds a threshold that you have defined.
7. Click Create Alarm.

### To update an email notification list that was created using the CloudWatch console ###

1. Open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.
2. If necessary, change the region. From the navigation bar, select the region that meets your needs. For more information, see Regions and Endpoints in the Amazon Web Services General Reference.
3. In the navigation pane, click Alarms.
4. In the alarms list, select the check box next to the alarm you want to edit, and then click Modify.
5. In the Email list field, add or update the list of email addresses, and then click Save Changes.

### To update an email notification list that was created in the Amazon SNS console ###

1. Open the Amazon SNS console at https://console.aws.amazon.com/sns/.
2. If necessary, change the region. From the navigation bar, select the region that meets your needs. For more information, see Regions and Endpoints in the Amazon Web Services General Reference.
3. In the navigation pane, choose Topics, and then choose the arn for your notification list (topic).
4. Do one of the following:
4.1 To add an email address, choose Create subscription, in Protocol, choose Email, in Endpoint, type the email address of the new recipient, and then choose Create subscription.
4.2   To remove an email address, choose the Subscription ID, choose Other subscription actions, and then choose Delete subscriptions.
5. Choose Publish to topic.


## Metrics Pushed to Cloudwatch##

1. Memory Utilization
2. Disk Space
3. File Handles

## Alrams Configured ##

1. CPU Utilization
2. RDS Database Connections
3. EFS Burst Credit Limits


# References #

1. [Getting Started with Amazon CloudWatch](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/GettingStarted.html)
2. [Getting Started with Amazon Simple Notification Service](http://docs.aws.amazon.com/sns/latest/dg/GettingStarted.html)
3. [Getting Started with Auto Scaling](http://docs.aws.amazon.com/autoscaling/latest/userguide/GettingStartedTutorial.html)